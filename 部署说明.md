# 麻将馆记账系统部署说明

## 端口配置
- **后端端口**: 8087 (注意：端口87被浏览器视为不安全端口，已改为8087)
- **前端端口**: 88
- **后端API地址**: http://localhost:8087
- **前端访问地址**: http://localhost:88

## 部署步骤

### 1. 安装systemd服务

#### 安装后端服务
```bash
sudo cp /data/mjg/backend/mjg-backend.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable mjg-backend.service
sudo systemctl start mjg-backend.service
```

#### 安装前端服务
```bash
sudo cp /data/mjg/vue3-admin-better/mjg-frontend.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable mjg-frontend.service
sudo systemctl start mjg-frontend.service
```

### 2. 检查服务状态

```bash
# 检查后端服务状态
sudo systemctl status mjg-backend.service

# 检查前端服务状态
sudo systemctl status mjg-frontend.service
```

### 3. 查看服务日志

```bash
# 查看后端日志
sudo journalctl -u mjg-backend.service -f

# 查看前端日志
sudo journalctl -u mjg-frontend.service -f
```

### 4. 服务管理命令

```bash
# 启动服务
sudo systemctl start mjg-backend.service
sudo systemctl start mjg-frontend.service

# 停止服务
sudo systemctl stop mjg-backend.service
sudo systemctl stop mjg-frontend.service

# 重启服务
sudo systemctl restart mjg-backend.service
sudo systemctl restart mjg-frontend.service

# 禁用开机自启
sudo systemctl disable mjg-backend.service
sudo systemctl disable mjg-frontend.service

# 启用开机自启
sudo systemctl enable mjg-backend.service
sudo systemctl enable mjg-frontend.service
```

## 手动启动（测试用）

### 启动后端
```bash
cd /data/mjg/backend
./start.sh
```

### 启动前端
```bash
cd /data/mjg/vue3-admin-better
./start.sh
```

## 注意事项

1. 确保后端虚拟环境已正确安装依赖：
   ```bash
   cd /data/mjg/backend
   source venv/bin/activate
   pip install -r requirements.txt
   ```

2. 确保前端依赖已安装：
   ```bash
   cd /data/mjg/vue3-admin-better
   npm install
   ```

3. 确保端口8087和88未被占用：
   ```bash
   sudo netstat -tlnp | grep -E ':(8087|88)'
   ```

4. 如果服务启动失败，检查日志：
   ```bash
   sudo journalctl -u mjg-backend.service -n 50
   sudo journalctl -u mjg-frontend.service -n 50
   ```

## 访问地址

- 前端: http://localhost:88
- 后端API文档: http://localhost:8087/docs
- 后端健康检查: http://localhost:8087/health

